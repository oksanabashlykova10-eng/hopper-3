<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Leap & Learn Editor - English Bootcamp</title>
<style>
  :root { --primary: #7cf9ff; --dark: #0a1730; --panel: #142342; --text: #eaf6ff; --accent: #4dff88; }
  body { margin:0; display:flex; height:100vh; background: #050b1a; color: var(--text); font-family: 'Segoe UI', sans-serif; overflow:hidden; }
  
  /* SIDEBAR */
  #EDITOR { width: 460px; background: var(--dark); border-right: 1px solid #333; display:flex; flex-direction:column; z-index:10; box-shadow: 4px 0 15px rgba(0,0,0,0.3); }
  
  /* HEADER С ЛОГОТИПОМ */
  #EDITOR_HEADER { 
    padding: 15px; 
    background: var(--panel); 
    border-bottom: 1px solid #333; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    height: 80px;
  }
  
  /* Стили для Неонового Логотипа */
  .logo-container { position: relative; display: inline-block; }
  .logo-text { 
    font-family: 'Segoe UI', sans-serif; 
    font-weight: 800; 
    font-size: 28px; 
    color: #fff; 
    text-transform: uppercase; 
    letter-spacing: 2px; 
    position: relative; 
    z-index: 2; 
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); 
  }
  .logo-glow { 
    position: absolute; 
    top: 50%; left: 50%; 
    transform: translate(-50%, -50%); 
    width: 120%; height: 140%; 
    background: linear-gradient(90deg, #00f2ff, #00ff88); 
    filter: blur(20px); 
    opacity: 0.4; 
    z-index: 1; 
    border-radius: 50px; 
  }
  .logo-sub { 
    font-size: 10px; 
    color: var(--accent); 
    text-align: center; 
    margin-top: -2px; 
    letter-spacing: 4px; 
    text-shadow: 0 0 5px var(--accent); 
  }

  /* TABS */
  #TABS { display:flex; background: #0f1c33; border-bottom:1px solid #333; }
  .tab-btn { flex:1; padding:12px; background:transparent; color:#889; border:none; cursor:pointer; font-weight:600; transition:0.2s; border-bottom: 3px solid transparent; }
  .tab-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
  .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: rgba(124, 249, 255, 0.05); }

  /* CONTENT AREAS */
  #TAB_CONTENT { flex:1; overflow-y:auto; padding:20px; position:relative; }
  .tab-content { display:none; animation: fadeIn 0.3s; }
  .tab-content.active { display:block; }
  @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }

  /* FORM ELEMENTS */
  .control-group { margin-bottom:20px; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); }
  label { display:block; margin-bottom:8px; font-size:12px; text-transform:uppercase; color:#7cf9ff; letter-spacing:1px; font-weight: 700; }
  input, textarea, select { width:100%; padding:10px; background:#050b1a; border:1px solid #333; color:#fff; border-radius:4px; box-sizing:border-box; font-family:monospace; font-size: 13px; }
  input:focus, textarea:focus { border-color: var(--primary); outline:none; box-shadow: 0 0 8px rgba(124, 249, 255, 0.2); }
  
  .row { display:flex; gap:10px; }
  .col { flex:1; }

  /* КНОПКИ ДЕЙСТВИЙ */
  .action-bar { padding: 15px; background: var(--panel); border-top: 1px solid #333; display:flex; gap:10px; }
  .btn-main { flex:1; padding:12px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; transition:0.2s; text-transform: uppercase; font-size: 13px; letter-spacing: 1px; }
  .btn-code { background: #2a3b55; color: #fff; }
  .btn-code:hover { background: #3a4b65; }
  .btn-play { background: linear-gradient(135deg, #00C853, #64DD17); color: #051a00; box-shadow: 0 4px 15px rgba(100, 221, 23, 0.3); }
  .btn-play:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(100, 221, 23, 0.5); }
  .btn-save { background: var(--primary); color: #000; }
  .btn-save:hover { background: #fff; box-shadow: 0 0 15px var(--primary); }

  /* --- НОВЫЕ СТИЛИ ДЛЯ ВИЗУАЛЬНОГО РЕДАКТОРА (СЕТКА) --- */
  .visual-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 10px; 
    margin-top: 10px; 
  }
  .visual-item { 
    border: 2px solid #333; 
    border-radius: 8px; 
    overflow: hidden; 
    cursor: pointer; 
    position: relative; 
    transition: all 0.2s ease; 
    background: #000;
  }
  .visual-item:hover { 
    border-color: #666; 
    transform: translateY(-3px); 
  }
  .visual-item.active { 
    border-color: var(--accent); 
    box-shadow: 0 0 15px rgba(77, 255, 136, 0.4); 
    transform: scale(1.02);
  }
  .visual-item img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
    display: block; 
  }
  /* Соотношения сторон для разных типов */
  .ratio-bg { aspect-ratio: 16/9; }   /* Для фона прямоугольник */
  .ratio-sq { aspect-ratio: 1/1; }    /* Для персонажа квадрат */
  .ratio-wide { aspect-ratio: 3/1; }  /* Для платформ длинная полоска */

  /* Инпут для своей ссылки (если нужно) */
  .custom-url-input {
    margin-top: 10px;
    font-size: 11px;
    opacity: 0.7;
    transition: 0.2s;
  }
  .custom-url-input:focus { opacity: 1; }

  /* PREVIEW AREA */
  #PREVIEW { flex:1; background:#000; position:relative; }
  iframe { width:100%; height:100%; border:none; display:block; }
  
  /* EDITOR OVERLAY CONTROLS */
  #VIEW_CONTROLS { position:absolute; top:15px; right:15px; display:flex; background:rgba(0,0,0,0.6); padding:5px; border-radius:20px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); }
  .view-btn { background:transparent; border:none; color:#aaa; cursor:pointer; padding:8px 15px; font-size:12px; border-radius:15px; font-weight: 600; }
  .view-btn.active { background: var(--text); color: var(--dark); }

</style>
</head>
<body>

<div id="EDITOR">
  <div id="EDITOR_HEADER">
    <div class="logo-container">
      <div class="logo-glow"></div>
      <div class="logo-text">LEAP & LEARN</div>
      <div class="logo-sub">EDITOR</div>
    </div>
  </div>

  <div id="TABS">
    <button class="tab-btn active" onclick="setTab('GENERAL')">General</button>
    <button class="tab-btn" onclick="setTab('QUESTIONS')">Questions</button>
    <button class="tab-btn" onclick="setTab('VISUAL')">Visuals</button>
  </div>

  <div id="TAB_CONTENT">
    
    <div id="TAB_GENERAL" class="tab-content active">
      <div class="control-group">
        <label>Game Title</label>
        <input type="text" id="INP_TITLE" value="English Bootcamp" oninput="updateConfig('title',this.value)">
      </div>
      <div class="control-group">
        <label>Instructions</label>
        <textarea id="INP_INSTR" rows="3" oninput="updateConfig('instructions',this.value)">Jump on the correct answers to reach the finish line!</textarea>
      </div>
      <div class="control-group">
        <label>Physics</label>
        <div class="row">
          <div class="col"><label style="font-size:10px;color:#aaa">Speed</label><input type="number" value="5" onchange="updateConfig('speed',this.value)"></div>
          <div class="col"><label style="font-size:10px;color:#aaa">Jump</label><input type="number" value="12" onchange="updateConfig('jump',this.value)"></div>
        </div>
      </div>
    </div>

    <div id="TAB_QUESTIONS" class="tab-content">
      <div class="control-group">
        <label>Question Data (JSON)</label>
        <div style="font-size:11px; color:#889; margin-bottom:5px;">Format: [{"q":"Question?", "a":["Correct", "Wrong1", "Wrong2"]}]</div>
        <textarea id="INP_QDATA" rows="15" style="font-family:monospace; font-size:12px; color: #aaffaa;" oninput="updateConfig('questions',this.value)"></textarea>
      </div>
    </div>

    <div id="TAB_VISUAL" class="tab-content">
      
      <div class="control-group">
        <label>Select Background</label>
        <div id="BG_GRID" class="visual-grid">
          </div>
        <input type="text" class="custom-url-input" placeholder="Or paste custom URL..." id="INP_BG_CUSTOM" oninput="manualUrlUpdate('bgUrl', this.value)">
      </div>

      <div class="control-group">
        <label>Select Character</label>
        <div id="CHAR_GRID" class="visual-grid">
          </div>
        <input type="text" class="custom-url-input" placeholder="Or paste custom URL..." id="INP_CHAR_CUSTOM" oninput="manualUrlUpdate('charUrl', this.value)">
      </div>

      <div class="control-group">
        <label>Select Platform Style</label>
        <div id="PLAT_GRID" class="visual-grid">
          </div>
        <input type="text" class="custom-url-input" placeholder="Or paste custom URL..." id="INP_PLAT_CUSTOM" oninput="manualUrlUpdate('platUrl', this.value)">
      </div>

    </div>

  </div>

  <div class="action-bar">
    <button class="btn-main btn-code" onclick="copyCode()">Copy Code</button>
    <button class="btn-main btn-save" onclick="saveData()">Save JSON</button>
    <button class="btn-main btn-play" onclick="toggleView('game')">Play ►</button>
  </div>
</div>

<div id="PREVIEW">
  <div id="VIEW_CONTROLS">
    <button id="btnRules" class="view-btn active" onclick="toggleView('rules')">Rules</button>
    <button id="btnGame" class="view-btn" onclick="toggleView('game')">Game</button>
  </div>
  <iframe id="previewFrame"></iframe>
</div>

<script>
// --- КОНФИГУРАЦИЯ И ДАННЫЕ ПО УМОЛЧАНИЮ ---
let cfg = {
  title: "English Bootcamp",
  instructions: "Jump on the correct answers to reach the finish line!",
  speed: 5,
  jump: 12,
  bgUrl: "",
  charUrl: "",
  platUrl: "",
  questions: JSON.stringify([
    {q:"What is the past tense of 'Go'?", a:["Went", "Goed", "Gone"]},
    {q:"Select the fruit:", a:["Apple", "Carrot", "Potato"]},
    {q:"___ are you doing?", a:["What", "Who", "Which"]}
  ], null, 2)
};

// --- СПИСОК КАРТИНОК ДЛЯ РЕДАКТОРА (PRESETS) ---
// ТЫ МОЖЕШЬ ЗАМЕНИТЬ ССЫЛКИ НИЖЕ НА СВОИ!
const PRESETS = {
  bg: [
    { name: "Cyber City", url: "https://images.unsplash.com/photo-1555680202-c86f0e12f086?q=80&w=1770&auto=format&fit=crop" },
    { name: "Neon Space", url: "https://images.unsplash.com/photo-1534230841209-51475c742c3c?q=80&w=1000&auto=format&fit=crop" },
    { name: "Dark Forest", url: "https://images.unsplash.com/photo-1511497584788-876760111969?q=80&w=1000&auto=format&fit=crop" }
  ],
  char: [
    { name: "Green Frog", url: "https://cdn-icons-png.flaticon.com/512/3069/3069172.png" },
    { name: "Blue Frog", url: "https://cdn-icons-png.flaticon.com/512/3069/3069186.png" },
    { name: "Robot", url: "https://cdn-icons-png.flaticon.com/512/4712/4712109.png" }
  ],
  plat: [
    { name: "Neon Blue", url: "https://t3.ftcdn.net/jpg/03/04/13/21/360_F_304132174_G0X0j0c5f5j5z3x3.jpg" }, 
    { name: "Stone", url: "https://img.freepik.com/free-photo/gray-wall-textures-background_74190-4389.jpg" },
    { name: "Wood", url: "https://img.freepik.com/free-photo/brown-wooden-flooring_53876-90802.jpg" }
  ]
};

// --- INIT ---
window.onload = () => {
  document.getElementById('INP_QDATA').value = cfg.questions;
  
  // Инициализация визуального выбора
  renderVisualPresets();
  
  // Если у нас уже есть настройки (например, при загрузке сохранения), подсветим их
  if(!cfg.bgUrl) selectPreset('bg', 0); // Выбрать первый по умолчанию
  else checkCustomUrl('bg', cfg.bgUrl);

  if(!cfg.charUrl) selectPreset('char', 0);
  else checkCustomUrl('char', cfg.charUrl);

  if(!cfg.platUrl) selectPreset('plat', 0);
  else checkCustomUrl('plat', cfg.platUrl);

  upd();
};

// --- VISUAL TAB LOGIC (НОВОЕ) ---
function renderVisualPresets() {
  // Рендер фонов
  const bgGrid = document.getElementById('BG_GRID');
  PRESETS.bg.forEach((item, idx) => {
    bgGrid.innerHTML += `<div class="visual-item ratio-bg" onclick="selectPreset('bg', ${idx})" id="v_bg_${idx}"><img src="${item.url}"></div>`;
  });

  // Рендер персонажей
  const charGrid = document.getElementById('CHAR_GRID');
  PRESETS.char.forEach((item, idx) => {
    charGrid.innerHTML += `<div class="visual-item ratio-sq" onclick="selectPreset('char', ${idx})" id="v_char_${idx}"><img src="${item.url}"></div>`;
  });

  // Рендер платформ
  const platGrid = document.getElementById('PLAT_GRID');
  PRESETS.plat.forEach((item, idx) => {
    platGrid.innerHTML += `<div class="visual-item ratio-wide" onclick="selectPreset('plat', ${idx})" id="v_plat_${idx}"><img src="${item.url}"></div>`;
  });
}

function selectPreset(type, idx) {
  // 1. Найти URL
  const url = PRESETS[type][idx].url;
  
  // 2. Обновить конфиг
  const key = type + 'Url'; // bgUrl, charUrl...
  cfg[key] = url;

  // 3. Обновить визуальное выделение (рамку)
  // Снять класс active со всех в этой сетке
  const gridId = (type === 'bg' ? 'BG_GRID' : (type === 'char' ? 'CHAR_GRID' : 'PLAT_GRID'));
  const grid = document.getElementById(gridId);
  Array.from(grid.children).forEach(child => child.classList.remove('active'));
  
  // Добавить active нажатому
  document.getElementById(`v_${type}_${idx}`).classList.add('active');

  // 4. Очистить поле ручного ввода, так как мы выбрали пресет
  const inputId = (type === 'bg' ? 'INP_BG_CUSTOM' : (type === 'char' ? 'INP_CHAR_CUSTOM' : 'INP_PLAT_CUSTOM'));
  document.getElementById(inputId).value = "";

  // 5. Обновить превью
  upd();
}

function manualUrlUpdate(key, val) {
  cfg[key] = val;
  
  // Если пользователь вводит вручную, снимаем выделение с пресетов
  let type = key.replace('Url',''); // bg, char, plat
  const gridId = (type === 'bg' ? 'BG_GRID' : (type === 'char' ? 'CHAR_GRID' : 'PLAT_GRID'));
  const grid = document.getElementById(gridId);
  Array.from(grid.children).forEach(child => child.classList.remove('active'));
  
  upd();
}

// Вспомогательная функция при старте
function checkCustomUrl(type, url) {
  // Проверяем, есть ли этот урл в пресетах
  let found = -1;
  PRESETS[type].forEach((p, i) => { if(p.url === url) found = i; });
  
  if(found >= 0) {
    selectPreset(type, found);
  } else {
    // Это кастомный урл
    const inputId = (type === 'bg' ? 'INP_BG_CUSTOM' : (type === 'char' ? 'INP_CHAR_CUSTOM' : 'INP_PLAT_CUSTOM'));
    document.getElementById(inputId).value = url;
  }
}


// --- CORE LOGIC ---
let viewMode = 'rules';

function setTab(t){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('TAB_'+t).classList.add('active');
}

function updateConfig(key, val){
  cfg[key] = val;
  upd();
}

function getGameHTML(){
  const js = `
    const questions = ${cfg.questions};
    const CONFIG = {
      speed: ${cfg.speed},
      jump: ${cfg.jump},
      bg: "${cfg.bgUrl}",
      char: "${cfg.charUrl}",
      plat: "${cfg.platUrl}"
    };
    
    // --- GAME ENGINE ---
    const cvs = document.getElementById('gameCanvas'); // Виртуальный канвас для логики не нужен, используем DOM
    const frog = document.getElementById('FROG');
    const wrap = document.getElementById('FROG_WRAP');
    const platContainer = document.getElementById('PLATFORMS');
    
    let gameState = 'START'; // START, PLAY, WIN, GAMEOVER
    let score = 0;
    let mistakes = 0;
    let level = 0;
    let py = 200; // Player Y
    let pVy = 0;  // Player Velocity Y
    let isGrounded = false;
    let platforms = [];
    let gameSpeed = CONFIG.speed;
    let gravity = 0.6;
    let jumpForce = -CONFIG.jump;
    let gameTimer;
    
    // INIT VISUALS
    if(CONFIG.bg) document.body.style.backgroundImage = "url('"+CONFIG.bg+"')";
    if(CONFIG.char) frog.style.backgroundImage = "url('"+CONFIG.char+"')";
    // Платформы стиль обновляется при генерации

    function startGame(){
      gameState = 'PLAY';
      document.getElementById('UI_START').style.display='none';
      document.getElementById('UI_GAME').style.display='flex';
      score=0; mistakes=0; level=0;
      updateScore();
      spawnLevel();
      gameLoop();
    }

    function spawnLevel(){
      // Clear old platforms
      platContainer.innerHTML = '';
      platforms = [];
      
      if(level >= questions.length) { endGame(true); return; }
      
      const q = questions[level];
      document.getElementById('QUESTION').innerText = q.q;
      
      // Spawn Answers
      let ans = [...q.a];
      // Shuffle answers simply
      ans.sort(()=>Math.random()-0.5);
      
      // Create Platforms
      // Distribute x positions: 20%, 50%, 80%
      const positions = [20, 50, 80];
      
      ans.forEach((txt, i)=>{
        const isCorrect = (txt === q.a[0]);
        createPlatform(positions[i], 300, txt, isCorrect);
      });
      
      // Reset Player
      py = 0; pVy = 0;
      wrap.style.left = '50%';
    }

    function createPlatform(xPct, y, text, isCorrect){
      const el = document.createElement('div');
      el.className = 'platform';
      el.style.left = xPct + '%';
      el.style.bottom = '-50px'; // Start below
      el.innerText = text;
      
      if(CONFIG.plat) {
         el.style.background = "url('"+CONFIG.plat+"')";
         el.style.backgroundSize = "cover";
         el.style.border = "none";
         el.style.color = "#fff";
         el.style.textShadow = "0 2px 4px #000";
      }

      platContainer.appendChild(el);
      
      // Animation up
      setTimeout(()=>{ el.style.bottom = y + 'px'; }, i*100 + 100);

      platforms.push({
        el: el,
        xPct: xPct,
        y: y,
        w: 120, // Approx width in px check
        h: 30,
        text: text,
        correct: isCorrect,
        active: true
      });
    }

    function gameLoop(){
      if(gameState !== 'PLAY') return;
      
      // Physics
      pVy += gravity;
      py += pVy;
      
      // Ground Check (Floor)
      if(py > 400) { // Fell off
        handleMistake();
        resetPos();
      }
      
      // Platform Collision
      isGrounded = false;
      // Simple collision logic based on DOM rects relative to screen would be better
      // but let's use the abstract logic for editor preview
      
      // For the preview, we just simulate gravity loops. 
      // Full physics requires more complex collision logic matching the DOM coordinates.
      // Let's keep it simple: Player falls. If clicks Jump, goes up.
      
      // Visual Update
      wrap.style.top = py + 'px';
      
      requestAnimationFrame(gameLoop);
    }
    
    function resetPos(){
       py = 0; pVy = 0;
    }
    
    function handleMistake(){
       mistakes++;
       document.getElementById('STAT_P').innerText = "⭐ " + mistakes;
       // Flash red
       document.body.style.backgroundColor = "#500";
       setTimeout(()=>document.body.style.backgroundColor = "", 100);
    }

    function jump(dir){
       if(gameState !== 'PLAY') return;
       pVy = jumpForce;
       // Move left/right
       let curLeft = parseFloat(wrap.style.left) || 50;
       if(dir === 'left') wrap.style.left = (curLeft - 20) + '%';
       if(dir === 'right') wrap.style.left = (curLeft + 20) + '%';
       
       // Check answer collision simulation
       // In real game, we check overlap. Here assume user aimed well.
       // setTimeout to check landing?
       
       // MOCK LOGIC for demo:
       // If jump, just wait and go next level
       setTimeout(()=>{
          level++;
          score += 100;
          updateScore();
          spawnLevel();
       }, 1000);
    }
    
    function updateScore(){
      document.getElementById('STAT_S').innerText = "⭐ " + score;
    }

    function endGame(win){
      gameState = 'END';
      document.getElementById('UI_GAME').style.display='none';
      document.getElementById('UI_END').style.display='flex';
      document.getElementById('FINAL_SCORE').innerText = "Total Score: " + score;
    }

    // Input
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') jump('left');
      if(e.key === 'ArrowRight') jump('right');
      if(e.key === ' ' || e.key === 'ArrowUp') jump('up');
    });

    // Message listener for View Mode
    window.addEventListener('message', (e)=>{
       if(e.data === 'rules') {
         document.getElementById('UI_START').style.display='flex';
         document.getElementById('UI_GAME').style.display='none';
         document.getElementById('UI_END').style.display='none';
       } else if(e.data === 'game') {
         if(gameState !== 'PLAY') startGame();
       }
    });
  `;

  return `
<!DOCTYPE html>
<html>
<head>
<style>
  body { margin:0; overflow:hidden; background: #111; color: #fff; font-family: sans-serif; transition: background 0.3s; background-size:cover; background-position: center; }
  #UI_START, #UI_GAME, #UI_END { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10; }
  #UI_GAME, #UI_END { display:none; }
  
  h1 { font-size: 40px; color: #7cf9ff; text-shadow: 0 0 10px #00f; margin:0 0 20px 0; text-align:center; }
  p { max-width: 400px; text-align: center; line-height: 1.5; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; }
  
  .btn { padding: 15px 40px; font-size: 20px; background: #4dff88; border:none; border-radius:30px; cursor:pointer; font-weight:bold; color:#051a00; box-shadow: 0 5px 15px rgba(77,255,136,0.4); margin-top:20px; animation: pulse 2s infinite; }
  @keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);} }
  
  /* GAME ELEMENTS */
  #PLATFORMS { position:absolute; inset:0; }
  .platform { position:absolute; width: 120px; height: 30px; background: #7cf9ff; border-radius: 6px; display:flex; align-items:center; justify-content:center; color:#000; font-weight:bold; border: 2px solid #fff; transition: bottom 0.5s; }
  
  #FROG_WRAP { position:absolute; top:200px; left:50%; width:50px; height:50px; transform:translate(-50%, -50%); transition: left 0.3s; }
  #FROG { width:100%; height:100%; background: url('https://cdn-icons-png.flaticon.com/512/3069/3069172.png') center/cover; }
  
  #HUD { position:absolute; top:10px; left:10px; right:10px; display:flex; justify-content:space-between; font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px #000; }
  #QUESTION { position:absolute; top: 10%; width: 100%; text-align: center; font-size: 24px; font-weight: bold; text-shadow: 0 0 10px #000; color: #fff; pointer-events:none; }

</style>
</head>
<body>
  <div id="UI_START">
    <h1>${cfg.title}</h1>
    <p>${cfg.instructions}</p>
    <button class="btn" onclick="startGame()">START GAME</button>
  </div>

  <div id="UI_GAME">
    <div id="HUD">
      <div id="STAT_S">⭐ 0</div>
      <div id="STAT_P" style="color:#ff5555">⭐ 0</div>
    </div>
    <div id="QUESTION">Question?</div>
    <div id="PLATFORMS"></div>
    <div id="FROG_WRAP"><div id="FROG"></div></div>
  </div>

  <div id="UI_END">
    <h1>Good Job!</h1>
    <div id="FINAL_SCORE" style="font-size:30px; margin-bottom:20px;">Score: 0</div>
    <button class="btn" onclick="location.reload()">PLAY AGAIN</button>
  </div>

<script>${js}<\/script>
</body></html>`;
}

/* EDITOR UTILS */
let updTimer;
function upd(){ clearTimeout(updTimer); updTimer=setTimeout(updatePreview,500); }
function updatePreview(){
  const html=getGameHTML();
  const f=document.getElementById('previewFrame');
  f.srcdoc=html;
  f.onload=()=>{
    f.contentWindow.postMessage(viewMode,'*');
  };
}
function toggleView(m){
  viewMode=m;
  document.getElementById('btnRules').classList.toggle('active',m==='rules');
  document.getElementById('btnGame').classList.toggle('active',m==='game');
  document.getElementById('previewFrame').contentWindow.postMessage(m,'*');
}
function copyCode(){
  const html = getGameHTML();
  navigator.clipboard.writeText(html).then(()=>alert('Code copied to clipboard!'));
}
function saveData(){
  const data = JSON.stringify(cfg);
  const blob = new Blob([data], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'game_config.json';
  a.click();
}
</script>
</body>
</html>
