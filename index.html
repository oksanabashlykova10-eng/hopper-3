<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Leap & Learn: Ultimate Pro Editor</title>
    <style>
        :root { --accent: #7cf9ff; --bg: #050b1a; --panel: #142342; --text: #eaf6ff; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; background: var(--bg); color: var(--text); overflow: hidden; }
        
        /* SIDEBAR */
        #editor { width: 500px; min-width: 500px; background: #0a1730; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .header { padding: 15px; background: var(--panel); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .tabs { display: flex; background: #000; flex-wrap: wrap; }
        .tab { flex: 1; padding: 12px; font-size: 10px; font-weight: bold; cursor: pointer; text-align: center; opacity: 0.5; border-bottom: 2px solid transparent; }
        .tab.active { opacity: 1; border-bottom-color: var(--accent); background: rgba(124, 249, 255, 0.05); }
        
        .content { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .group { background: var(--panel); border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid #2a3b5a; }
        h4 { margin: 0 0 12px 0; font-size: 11px; text-transform: uppercase; color: var(--accent); }

        label { display: block; font-size: 11px; margin-bottom: 4px; opacity: 0.8; }
        input, select, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #334155; background: #0a1730; color: white; box-sizing: border-box; }
        .row { display: flex; gap: 10px; align-items: center; }
        input[type="color"] { width: 40px; height: 40px; cursor: pointer; padding: 0; border: none; background: none; }
        
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-main { background: var(--accent); color: #000; width: 100%; margin-top: 10px; }

        /* PREVIEW */
        #preview-zone { flex-grow: 1; position: relative; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }

        /* MODAL */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; padding: 40px; }
        .modal-box { background: var(--panel); width: 100%; max-width: 1000px; margin: auto; height: 80vh; border-radius: 15px; border: 2px solid var(--accent); display: flex; flex-direction: column; padding: 20px; }
        .qa-container { display: flex; gap: 20px; flex: 1; min-height: 0; }
        .qa-box { flex: 1; display: flex; flex-direction: column; }
        .qa-box textarea { flex: 1; font-family: monospace; resize: none; font-size: 13px; }
    </style>
</head>
<body>

<div id="editor">
    <div class="header">
        <h2 style="margin:0; font-size:16px;">LEAP & LEARN BUILDER</h2>
        <button class="btn" style="background:#fff;" onclick="exportFinal()">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î</button>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showT('viz')">–í–ò–ó–£–ê–õ</div>
        <div class="tab" onclick="showT('hero')">–ì–ï–†–û–ô/–§–û–ù</div>
        <div class="tab" onclick="showT('game')">–ì–ï–ô–ú–ü–õ–ï–ô</div>
        <div class="tab" onclick="showT('snd')">–ó–í–£–ö–ò</div>
        <div class="tab" onclick="showT('lvl')">–ó–ê–î–ê–ù–ò–Ø</div>
    </div>

    <div class="content">
        <div id="t-viz" class="pane">
            <div class="group">
                <h4>üé® –¶–≤–µ—Ç–∞ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
                <div class="row"><input type="color" id="c-bg" value="#0a1730" oninput="upd()"><label>–§–æ–Ω —ç–∫—Ä–∞–Ω–æ–≤</label></div>
                <div class="row" style="margin-top:10px"><input type="color" id="c-ui" value="#7cf9ff" oninput="upd()"><label>–¶–≤–µ—Ç –Ω–µ–æ–Ω–∞ (–†–∞–º–∫–∏/–ö–Ω–æ–ø–∫–∏)</label></div>
                <div class="row" style="margin-top:10px"><label><input type="checkbox" id="c-neon" checked onchange="upd()"> –ì–ª–æ–±–∞–ª—å–Ω—ã–π –Ω–µ–æ–Ω</label></div>
            </div>
            <div class="group">
                <h4>üî† –®—Ä–∏—Ñ—Ç</h4>
                <div class="row"><input type="color" id="c-font" value="#ffffff" oninput="upd()"><label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label></div>
                <label>–†–∞–∑–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ (px)</label>
                <input type="number" id="f-size" value="28" oninput="upd()">
            </div>
        </div>

        <div id="t-hero" class="pane" style="display:none">
            <div class="group">
                <h4>üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂</h4>
                <select id="h-sel" onchange="hChg(this.value)">
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png">–õ—è–≥—É—à–∫–∞</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/74b56fcf-5354-43dd-9c9a-f50facc9a9bf.png">–•–∞–º–µ–ª–µ–æ–Ω</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/0feda2a1-485a-4654-8640-bf1adcc9f9ec.png">–Ø—â–µ—Ä–∏—Ü–∞</option>
                    <option value="custom">–°–≤–æ–π (–ó–∞–≥—Ä—É–∑–∏—Ç—å...)</option>
                </select>
                <div id="h-custom" style="display:none"><input type="file" accept="image/*" onchange="readI(this,'h-url')"><input type="text" id="h-url" placeholder="URL..." oninput="upd()"></div>
            </div>
            <div class="group">
                <h4>üèûÔ∏è –õ–æ–∫–∞—Ü–∏—è</h4>
                <select id="b-sel" onchange="bChg(this.value)">
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png">–†–µ–∫–∞</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/fa2ab459-fec9-4ccd-97e3-254427b4ade0.png">–õ–∞–≤–∞</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/02b52ad4-9d31-4b21-a305-8fec6e8a4487.png">–ë–æ–ª–æ—Ç–æ</option>
                    <option value="custom">–°–≤–æ–π —Ñ–æ–Ω...</option>
                </select>
                <div id="b-custom" style="display:none"><input type="file" accept="image/*" onchange="readI(this,'b-url')"><input type="text" id="b-url" placeholder="URL —Ñ–æ–Ω–∞..." oninput="upd()"></div>
                <label style="margin-top:10px">–í–∏–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</label>
                <select id="p-sel" onchange="upd()">
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png">–õ–∏–ª–∏—è</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/bad37c6d-f04c-45c0-b954-807d79ec3a95.png">–ö–∞–º–µ–Ω—å</option>
                    <option value="https://img.genially.com/67961b32a116fb001568a75e/c6775617-bde5-43e4-9da8-5332d928807e.png">–ö–æ—á–∫–∞</option>
                </select>
            </div>
        </div>

        <div id="t-game" class="pane" style="display:none">
            <div class="group">
                <h4>‚öôÔ∏è –ü—Ä–∞–≤–∏–ª–∞</h4>
                <label>–í—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç (—Å–µ–∫)</label>
                <input type="number" id="g-time" value="10" oninput="upd()">
                <label>–ñ–∏–∑–Ω–∏</label>
                <input type="number" id="g-lives" value="3" oninput="upd()">
            </div>
            <div class="group">
                <h4>‚ú® –≠—Ñ—Ñ–µ–∫—Ç—ã</h4>
                <label>–≠—Ñ—Ñ–µ–∫—Ç –ø–æ–±–µ–¥—ã</label>
                <select id="g-fx" onchange="upd()">
                    <option value="fireworks">üéÜ –°–∞–ª—é—Ç—ã</option>
                    <option value="confetti">üéâ –ö–æ–Ω—Ñ–µ—Ç—Ç–∏</option>
                    <option value="magic">‚ú® –ú–∞–≥–∏—è</option>
                </select>
                <div class="row" style="margin-top:10px"><input type="color" id="c-combo" value="#ff00ff" oninput="upd()"><label>–¶–≤–µ—Ç –∫–æ–º–±–æ-–Ω–µ–æ–Ω–∞</label></div>
            </div>
        </div>

        <div id="t-snd" class="pane" style="display:none">
            <div class="group">
                <h4>üîä –ó–≤—É–∫–∏ (URL)</h4>
                <label>–í–µ—Ä–Ω–æ</label><input type="text" id="s-ok" oninput="upd()">
                <label>–û—à–∏–±–∫–∞</label><input type="text" id="s-no" oninput="upd()">
                <label>–§–∏–Ω–∞–ª –ü–æ–±–µ–¥–∞</label><input type="text" id="s-win" oninput="upd()">
                <label>–§–∏–Ω–∞–ª –ü—Ä–æ–≤–∞–ª</label><input type="text" id="s-lose" oninput="upd()">
            </div>
        </div>

        <div id="t-lvl" class="pane" style="display:none">
            <div id="lvl-container"></div>
            <button class="btn btn-main" onclick="addL()">+ –î–û–ë–ê–í–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
        </div>
    </div>
</div>

<div id="preview-zone"><iframe id="f-p"></iframe></div>

<div id="modal">
    <div class="modal-box">
        <h2 id="m-t">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–¥–∞–Ω–∏–π</h2>
        <div class="qa-container">
            <div class="qa-box"><label>–í–æ–ø—Ä–æ—Å—ã (—Å—Ç—Ä–æ–∫–∞ = –≤–æ–ø—Ä–æ—Å)</label><textarea id="m-q"></textarea></div>
            <div class="qa-box"><label>–û—Ç–≤–µ—Ç—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π|–ª–æ–∂—å|–ª–æ–∂—å)</label><textarea id="m-a"></textarea></div>
        </div>
        <button class="btn btn-main" onclick="saveL()">–°–û–•–†–ê–ù–ò–¢–¨ –ò –ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<script>
    let levels = [{name:"–£—Ä–æ–≤–µ–Ω—å 1", q:["2 + 2 ="], a:["4|5|3"]}];
    let curL = 0;

    function showT(id){
        document.querySelectorAll('.pane').forEach(p=>p.style.display='none');
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.getElementById('t-'+id).style.display='block';
        event.currentTarget.classList.add('active');
    }

    function hChg(v){ document.getElementById('h-custom').style.display = v==='custom'?'block':'none'; upd(); }
    function bChg(v){ document.getElementById('b-custom').style.display = v==='custom'?'block':'none'; upd(); }
    function readI(input, id){
        const f = input.files[0];
        if(f){ const r = new FileReader(); r.onload=(e)=>{document.getElementById(id).value=e.target.result; upd();}; r.readAsDataURL(f); }
    }

    function addL(){ levels.push({name:"–£—Ä–æ–≤–µ–Ω—å "+(levels.length+1), q:[""], a:[""]}); rL(); }
    function rL(){
        const c = document.getElementById('lvl-container'); c.innerHTML='';
        levels.forEach((l,i)=>{
            const d=document.createElement('div'); d.className='group';
            d.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><span>\${l.name}</span><button class="btn" style="background:var(--accent);color:#000" onclick="openL(\${i})">‚öôÔ∏è –ó–∞–¥–∞–Ω–∏—è</button></div>`;
            c.appendChild(d);
        });
        upd();
    }

    function openL(i){ curL=i; document.getElementById('m-t').innerText=levels[i].name; document.getElementById('m-q').value=levels[i].q.join('\n'); document.getElementById('m-a').value=levels[i].a.join('\n'); document.getElementById('modal').style.display='flex'; }
    function saveL(){ levels[curL].q=document.getElementById('m-q').value.split('\n'); levels[curL].a=document.getElementById('m-a').value.split('\n'); document.getElementById('modal').style.display='none'; rL(); }

    function upd(){
        const cfg = {
            bg: document.getElementById('b-sel').value==='custom'?document.getElementById('b-url').value:document.getElementById('b-sel').value,
            hero: document.getElementById('h-sel').value==='custom'?document.getElementById('h-url').value:document.getElementById('h-sel').value,
            plat: document.getElementById('p-sel').value,
            cUI: document.getElementById('c-ui').value,
            cFont: document.getElementById('c-font').value,
            fSize: document.getElementById('f-size').value,
            cBg: document.getElementById('c-bg').value,
            neon: document.getElementById('c-neon').checked,
            time: document.getElementById('g-time').value,
            lives: document.getElementById('g-lives').value,
            fx: document.getElementById('g-fx').value,
            combo: document.getElementById('c-combo').value,
            sfx: {ok:document.getElementById('s-ok').value, no:document.getElementById('s-no').value, win:document.getElementById('s-win').value, lose:document.getElementById('s-lose').value},
            lvls: levels
        };

        const html = `
<!DOCTYPE html>
<html>
<head>
<style>
    :root { --n: \${cfg.cUI}; --f: \${cfg.cFont}; }
    body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family:sans-serif; background:\${cfg.cBg}; color:var(--f); }
    #STAGE { width:100%; height:100%; position:relative; background:url('\${cfg.bg}') center/cover; }
    .panel { 
        padding:10px 20px; background:rgba(0,0,0,0.7); border:2px solid var(--n); border-radius:12px;
        box-shadow: \${cfg.neon?'0 0 15px var(--n)':'none'}; font-weight:bold;
    }
    #HUD { position:absolute; top:20px; left:20px; display:flex; gap:15px; z-index:10; }
    #Q { position:absolute; top:20%; width:100%; text-align:center; font-size:\${cfg.fSize}px; text-shadow:2px 2px 4px #000; padding:0 40px; box-sizing:border-box; }
    #HERO { position:absolute; bottom:15%; left:10%; width:120px; height:120px; background:url('\${cfg.hero}') center/contain no-repeat; transition:0.4s; }
    #PLATS { position:absolute; bottom:15%; width:100%; display:flex; justify-content:center; gap:60px; }
    .plat { width:150px; height:150px; background:url('\${cfg.plat}') center/contain no-repeat; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#000; }
    
    .screen { position:fixed; inset:0; background:rgba(5,11,26,0.95); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:100; text-align:center; }
    .table { background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; border:1px solid var(--n); margin:20px; min-width:320px; }
    .row { display:flex; justify-content:space-between; margin:8px 0; border-bottom:1px solid rgba(255,255,255,0.1); }
    .btn { padding:15px 40px; background:var(--n); color:#000; border:none; border-radius:10px; cursor:pointer; font-weight:bold; font-size:18px; }
</style>
</head>
<body>
    <div id="STAGE">
        <div id="HUD">
            <div class="panel">‚ù§Ô∏è <span id="lives">\${cfg.lives}</span></div>
            <div class="panel">‚è±Ô∏è <span id="timer">\${cfg.time}</span></div>
            <div class="panel">‚≠ê <span id="score">0</span></div>
        </div>
        <div id="Q"></div>
        <div id="HERO"></div>
        <div id="PLATS"></div>
    </div>

    <div id="SCR" class="screen">
        <h1 id="scr-t">LEAP & LEARN</h1>
        <div id="scr-c"></div>
        <button class="btn" id="scr-b" onclick="init()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <script>
        const c = \${JSON.stringify(cfg)};
        let curL=0, curQ=0, score=0, lScore=0, lives=c.lives, tick, gScore=0;
        const sOk=new Audio(c.sfx.ok), sNo=new Audio(c.sfx.no), sW=new Audio(c.sfx.win);

        function init(){ document.getElementById('SCR').style.display='none'; gScore=0; curL=0; lives=c.lives; startL(); }
        
        function startL(){
            curQ=0; lScore=0;
            loadQ();
        }

        function loadQ(){
            clearInterval(tick);
            const q = c.lvls[curL].q[curQ];
            const a = c.lvls[curL].a[curQ].split('|');
            document.getElementById('Q').innerText = q;
            const pb = document.getElementById('PLATS'); pb.innerHTML='';
            
            a.map((t,i)=>({t,ok:i===0})).sort(()=>Math.random()-0.5).forEach(o=>{
                const d=document.createElement('div'); d.className='plat'; d.innerText=o.t;
                d.onclick=()=>{ if(o.ok) { score+=100; lScore+=100; sOk.play(); next(); } else { lives--; sNo.play(); if(lives<=0) end(false); else next(); } };
                pb.appendChild(d);
            });

            let t=c.time; document.getElementById('timer').innerText=t;
            tick=setInterval(()=>{ t--; document.getElementById('timer').innerText=t; if(t<=0) {lives--; next();} },1000);
        }

        function next(){
            curQ++;
            if(curQ >= c.lvls[curL].q.length) summ();
            else loadQ();
            document.getElementById('lives').innerText=lives;
            document.getElementById('score').innerText=score;
        }

        function summ(){
            clearInterval(tick);
            gScore += lScore;
            const scr=document.getElementById('SCR'); scr.style.display='flex';
            document.getElementById('scr-t').innerText="–£–†–û–í–ï–ù–¨ –ü–†–û–ô–î–ï–ù!";
            document.getElementById('scr-c').innerHTML=\`<div class="table">
                <div class="row"><span>–û—á–∫–∏ —É—Ä–æ–≤–Ω—è:</span><span>\${lScore}</span></div>
                <div class="row"><span>–ë–æ–Ω—É—Å –∂–∏–∑–Ω–µ–π:</span><span>+\${lives*50}</span></div>
            </div>\`;
            curL++;
            const b = document.getElementById('scr-b');
            if(curL < c.lvls.length) { b.innerText="–î–ê–õ–ï–ï"; b.onclick=()=> {scr.style.display='none'; startL();}; }
            else end(true);
        }

        function end(w){
            clearInterval(tick);
            const scr=document.getElementById('SCR'); scr.style.display='flex';
            document.getElementById('scr-t').innerText=w?"–ü–û–ë–ï–î–ê!":"–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê";
            document.getElementById('scr-c').innerHTML=\`<h2>–ò–¢–û–ì: \${gScore + lives*50}</h2>\`;
            document.getElementById('scr-b').innerText="–ó–ê–ù–û–í–û";
            document.getElementById('scr-b').onclick=()=>location.reload();
            if(w) sW.play();
        }
    <\/script>
</body>
</html>`;
        document.getElementById('f-p').srcdoc = html;
    }

    function exportFinal(){ navigator.clipboard.writeText(document.getElementById('f-p').srcdoc); alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!"); }

    rL();
</script>
</body>
</html>
