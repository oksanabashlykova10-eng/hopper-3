<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Leap & Learn: Professional Studio</title>
<style>
  :root { --primary: #7cf9ff; --dark: #0a1730; --panel: #142342; --text: #eaf6ff; }
  body { margin:0; display:flex; height:100vh; background: #050b1a; color: var(--text); font-family: 'Segoe UI', sans-serif; overflow:hidden; }
  
  /* РЕДАКТОР */
  #EDITOR { width: 420px; min-width: 420px; background: var(--dark); border-right: 1px solid #333; display:flex; flex-direction:column; z-index:10; }
  .header { padding:15px; background:var(--panel); border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center; }
  .header h2 { margin:0; font-size:16px; color:var(--primary); text-transform:uppercase; }
  
  .tabs { display:flex; background:#000; }
  .tab { flex:1; padding:12px; text-align:center; font-size:11px; cursor:pointer; opacity:0.6; border-bottom:2px solid transparent; }
  .tab.active { opacity:1; border-bottom-color:var(--primary); color:var(--primary); background:rgba(124,249,255,0.05); }
  
  .content { flex:1; overflow-y:auto; padding:20px; }
  .group { background:var(--panel); border-radius:8px; padding:15px; margin-bottom:15px; border:1px solid #2a3b5a; }
  .group h3 { margin:0 0 12px 0; font-size:12px; color:var(--primary); text-transform:uppercase; }
  
  label { display:block; font-size:11px; color:#888; margin-bottom:4px; margin-top:10px; }
  input, textarea { width:100%; box-sizing:border-box; background:#050b1a; border:1px solid #334155; color:#fff; padding:8px; border-radius:4px; font-size:12px; }
  input[type="color"] { height:35px; padding:2px; }

  .btn { width:100%; padding:10px; background:var(--primary); color:#000; border:none; border-radius:4px; cursor:pointer; font-weight:bold; margin-top:10px; }
  .btn-copy { background:#fff; width:auto; padding:5px 10px; font-size:10px; margin:0; }
  
  /* ПРЕВЬЮ */
  #PREVIEW { flex:1; position:relative; background:#000; }
  iframe { width:100%; height:100%; border:none; }
</style>
</head>
<body>

<div id="EDITOR">
  <div class="header">
    <h2>LEAP & LEARN STUDIO</h2>
    <button class="btn btn-copy" onclick="copyFullCode()">КОПИРОВАТЬ КОД</button>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="showTab('media')">МЕДИА</div>
    <div class="tab" onclick="showTab('game')">ИГРА</div>
    <div class="tab" onclick="showTab('style')">СТИЛЬ</div>
  </div>

  <div class="content">
    <div id="t-media" class="pane">
      <div class="group">
        <h3>Рисунки (URL)</h3>
        <label>Фон игры</label>
        <input type="text" id="img_bg" value="https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png" oninput="upd()">
        <label>Персонаж (Лягушка)</label>
        <input type="text" id="img_hero" value="https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png" oninput="upd()">
        <label>Платформа</label>
        <input type="text" id="img_plat" value="https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png" oninput="upd()">
      </div>
      <div class="group">
        <h3>Звуки (MP3 URL)</h3>
        <label>Верно</label>
        <input type="text" id="s_ok" value="https://www.soundjay.com/buttons/sounds/button-3.mp3" oninput="upd()">
        <label>Ошибка</label>
        <input type="text" id="s_no" value="https://www.soundjay.com/buttons/sounds/button-10.mp3" oninput="upd()">
        <label>Победа</label>
        <input type="text" id="s_win" value="https://www.soundjay.com/misc/sounds/bell-ringing-01.mp3" oninput="upd()">
      </div>
    </div>

    <div id="t-game" class="pane" style="display:none">
      <div class="group">
        <h3>Параметры</h3>
        <label>Время на вопрос (сек)</label>
        <input type="number" id="g_time" value="15" oninput="upd()">
        <label>Жизни</label>
        <input type="number" id="g_lives" value="3" oninput="upd()">
      </div>
      <div class="group">
        <h3>Вопросы (Текст)</h3>
        <textarea id="g_data" rows="10" oninput="upd()" style="font-family:monospace; font-size:10px;">
Уровень 1
2+2=?|4|5|6
Столица РФ?|Москва|Париж|Рига

Уровень 2
Корень из 9?|3|9|1
Цвет неба?|Синий|Зеленый|Красный</textarea>
      </div>
    </div>

    <div id="t-style" class="pane" style="display:none">
      <div class="group">
        <h3>Цвета и Шрифты</h3>
        <label>Цвет Неона (основной)</label>
        <input type="color" id="c_neon" value="#7cf9ff" oninput="upd()">
        <label>Цвет Ошибки</label>
        <input type="color" id="c_err" value="#ff3b3b" oninput="upd()">
        <label>Размер текста вопроса (px)</label>
        <input type="number" id="f_size" value="30" oninput="upd()">
      </div>
    </div>
  </div>
</div>

<div id="PREVIEW">
  <iframe id="pFrame"></iframe>
</div>

<script>
function showTab(id){
  document.querySelectorAll('.pane').forEach(p=>p.style.display='none');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('t-'+id).style.display='block';
  event.currentTarget.classList.add('active');
}

function upd(){
  const frame = document.getElementById('pFrame');
  frame.srcdoc = getGameHTML();
}

function copyFullCode(){
  navigator.clipboard.writeText(getGameHTML()).then(()=>alert("Код скопирован!"));
}

function getGameHTML(){
  const cfg = {
    bg: document.getElementById('img_bg').value,
    hero: document.getElementById('img_hero').value,
    plat: document.getElementById('img_plat').value,
    neon: document.getElementById('c_neon').value,
    err: document.getElementById('c_err').value,
    fsize: document.getElementById('f_size').value,
    time: document.getElementById('g_time').value,
    lives: document.getElementById('g_lives').value,
    sfxOk: document.getElementById('s_ok').value,
    sfxNo: document.getElementById('s_no').value,
    sfxWin: document.getElementById('s_win').value,
    data: document.getElementById('g_data').value
  };

  // Парсинг уровней
  const levels = [];
  const blocks = cfg.data.split(/\n\s*\n/);
  blocks.forEach(block => {
    const lines = block.trim().split('\n');
    const name = lines.shift();
    const qs = lines.map(l => {
      const p = l.split('|');
      return { q: p[0], a: p[1], options: [p[1], p[2], p[3]].sort(()=>Math.random()-0.5) };
    });
    levels.push({ name, questions: qs });
  });

  // Возвращаем твой оригинальный код игры с внедренными переменными
  return `
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
  :root { 
    --neon-main: ${cfg.neon}; 
    --danger: ${cfg.err}; 
    --win: #ffe44d; 
  }
  body, html { margin:0; width:100%; height:100%; overflow:hidden; font-family:Arial; background:#0a1730; }
  
  #GAME { position:relative; width:100%; height:100%; background:url('${cfg.bg}') center/cover no-repeat; }
  #GAME.shake { animation: shake 0.25s; }
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }

  /* Экраны */
  .overlay { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:rgba(0,0,0,0.85); z-index:100; color:#fff; text-align:center; }
  .card { background:#142342; border:2px solid var(--neon-main); padding:30px; border-radius:15px; box-shadow:0 0 20px var(--neon-main); max-width:400px; }

  /* HUD */
  #HUD { position:absolute; top:20px; left:20px; display:flex; gap:15px; z-index:50; }
  .stat { background:rgba(0,0,0,0.6); padding:10px 20px; border:2px solid var(--neon-main); border-radius:20px; color:#fff; font-weight:bold; }

  /* Лягушка */
  #FROG { 
    position:absolute; bottom:150px; left:100px; width:100px; height:100px; 
    background:url('${cfg.hero}') center/contain no-repeat; z-index:10;
    transition: all 0.5s cubic-bezier(0.42, 0, 0.58, 1);
  }

  /* Платформы */
  .platform { 
    position:absolute; bottom:100px; width:160px; height:80px; 
    background:url('${cfg.plat}') center/contain no-repeat;
    display:flex; align-items:center; justify-content:center;
    color:#000; font-weight:bold; cursor:pointer; font-size:16px; transition: 0.3s;
  }
  .platform:hover { filter: brightness(1.2); transform: scale(1.05); }

  #QUESTION { 
    position:absolute; top:20%; width:100%; text-align:center; 
    color:#fff; font-size:${cfg.fsize}px; font-weight:bold; text-shadow:0 2px 10px #000;
  }

  button { background:var(--neon-main); border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:15px; }
  
  canvas { position:absolute; inset:0; pointer-events:none; z-index:200; }
</style>
</head>
<body>

<div id="GAME">
  <div id="HUD">
    <div class="stat">❤️ <span id="lives">${cfg.lives}</span></div>
    <div class="stat">⏱️ <span id="timer">${cfg.time}</span></div>
    <div class="stat">⭐ <span id="score">0</span></div>
  </div>

  <div id="QUESTION"></div>
  <div id="FROG"></div>
  <div id="PLATFORMS"></div>

  <div id="SCREEN_START" class="overlay">
    <div class="card">
      <h1 style="color:var(--neon-main)">LEAP & LEARN</h1>
      <p>Прыгай по платформам, отвечая правильно!</p>
      <button onclick="Game.start()">ИГРАТЬ</button>
    </div>
  </div>

  <div id="SCREEN_LEVEL" class="overlay" style="display:none">
    <div class="card">
      <h2 id="lvl_title">УРОВЕНЬ ПРОЙДЕН!</h2>
      <div id="lvl_stats" style="margin:15px 0; text-align:left; font-family:monospace"></div>
      <button onclick="Game.nextLevel()">ДАЛЕЕ</button>
    </div>
  </div>
</div>

<canvas id="FX"></canvas>

<script>
const LEVELS = ${JSON.stringify(levels)};
const CFG = ${JSON.stringify(cfg)};
const sndOk = new Audio(CFG.sfxOk);
const sndNo = new Audio(CFG.sfxNo);
const sndWin = new Audio(CFG.sfxWin);

const Game = {
  lvIdx: 0, qIdx: 0, 
  score: 0, lives: CFG.lives,
  timeLeft: CFG.time, timer: null,

  start() {
    document.getElementById('SCREEN_START').style.display = 'none';
    this.lvIdx = 0; this.score = 0; this.lives = CFG.lives;
    this.loadLevel();
  },

  loadLevel() {
    this.qIdx = 0;
    this.renderQuestion();
  },

  renderQuestion() {
    clearInterval(this.timer);
    const lvl = LEVELS[this.lvIdx];
    const qData = lvl.questions[this.qIdx];
    
    document.getElementById('QUESTION').innerText = qData.q;
    const pContainer = document.getElementById('PLATFORMS');
    pContainer.innerHTML = '';
    
    qData.options.forEach((opt, i) => {
      const p = document.createElement('div');
      p.className = 'platform';
      p.style.left = (20 + i * 30) + '%';
      p.innerText = opt;
      p.onclick = () => this.check(opt === qData.a, p);
      pContainer.appendChild(p);
    });

    this.timeLeft = CFG.time;
    document.getElementById('timer').innerText = this.timeLeft;
    this.timer = setInterval(() => {
      this.timeLeft--;
      document.getElementById('timer').innerText = this.timeLeft;
      if(this.timeLeft <= 0) this.check(false);
    }, 1000);
  },

  check(isCorrect, el) {
    clearInterval(this.timer);
    if(isCorrect) {
      sndOk.play();
      this.score += 100 + this.timeLeft * 10;
      this.jump(el);
      this.qIdx++;
      setTimeout(() => {
        if(this.qIdx >= LEVELS[this.lvIdx].questions.length) this.showLevelEnd();
        else this.renderQuestion();
      }, 600);
    } else {
      sndNo.play();
      document.getElementById('GAME').classList.add('shake');
      setTimeout(() => document.getElementById('GAME').classList.remove('shake'), 300);
      this.lives--;
      if(this.lives <= 0) this.gameOver();
      else this.renderQuestion();
    }
    this.updateHUD();
  },

  jump(targetEl) {
    const frog = document.getElementById('FROG');
    const rect = targetEl.getBoundingClientRect();
    frog.style.left = (rect.left + rect.width/2 - 50) + 'px';
    frog.style.bottom = '180px';
    setTimeout(() => frog.style.bottom = '150px', 300);
    fx.boom(rect.left + rect.width/2, rect.top);
  },

  updateHUD() {
    document.getElementById('lives').innerText = this.lives;
    document.getElementById('score').innerText = this.score;
  },

  showLevelEnd() {
    const screen = document.getElementById('SCREEN_LEVEL');
    screen.style.display = 'flex';
    document.getElementById('lvl_stats').innerHTML = \`
      Очки: \${this.score}<br>
      Жизни: \${this.lives}<br>
      Уровень: \${this.lvIdx + 1}
    \`;
    sndWin.play();
    fx.launch(5);
  },

  nextLevel() {
    this.lvIdx++;
    if(this.lvIdx >= LEVELS.length) {
       alert("ПОЗДРАВЛЯЕМ! ВСЯ ИГРА ПРОЙДЕНА!");
       location.reload();
    } else {
       document.getElementById('SCREEN_LEVEL').style.display = 'none';
       this.loadLevel();
    }
  },

  gameOver() {
    alert("ИГРА ОКОНЧЕНА! ВАШ СЧЕТ: " + this.score);
    location.reload();
  }
};

// Простой движок салютов (FX)
const fx = {
  cvs: document.getElementById('FX'),
  ctx: document.getElementById('FX').getContext('2d'),
  parts: [],
  init() {
    this.cvs.width = window.innerWidth;
    this.cvs.height = window.innerHeight;
    this.loop();
  },
  boom(x, y) {
    for(let i=0; i<20; i++) this.parts.push({
      x, y, 
      vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
      life: 1, c: CFG.neon
    });
  },
  launch(n) {
    for(let i=0; i<n; i++) setTimeout(() => this.boom(Math.random()*this.cvs.width, Math.random()*this.cvs.height), i*300);
  },
  loop() {
    this.ctx.clearRect(0,0,this.cvs.width, this.cvs.height);
    this.parts.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.vy += 0.2; p.life -= 0.02;
      this.ctx.fillStyle = p.c;
      this.ctx.globalAlpha = p.life;
      this.ctx.fillRect(p.x, p.y, 4, 4);
      if(p.life <= 0) this.parts.splice(i, 1);
    });
    requestAnimationFrame(() => this.loop());
  }
};
fx.init();
<\/script>
</body>
</html>
  `;
}

// Старт
upd();
</script>

</body>
</html>
